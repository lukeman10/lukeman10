<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Neon Asteroid Rogue â€“ Final</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #000;
    overflow: hidden;
    font-family: monospace;
    color: #0ff;
  }
  #ui {
    position: fixed;
    top: 10px;
    left: 10px;
    font-size: 14px;
    pointer-events: none;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="ui"></div>

<script>
/* ---------- SETUP ---------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const ui = document.getElementById("ui");

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize", resize);
resize();

/* ---------- INPUT ---------- */
const keys = {};
const mouse = { x: 0, y: 0, down: false };

addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);
addEventListener("mousemove", e => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
});
addEventListener("mousedown", () => mouse.down = true);
addEventListener("mouseup", () => mouse.down = false);

/* ---------- PLAYER ---------- */
const player = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  vx: 0,
  vy: 0,
  angle: 0,
  lives: 3,
  shootCooldown: 0
};

/* ---------- GAME STATE ---------- */
let bullets = [];
let asteroids = [];
let particles = [];
let score = 0;
let spawnTimer = 0;
let difficulty = 1;

/* ---------- UTIL ---------- */
function rand(min, max) {
  return Math.random() * (max - min) + min;
}

/* ---------- ASTEROIDS ---------- */
function createAsteroid(x, y, size = 3) {
  const radius = size * rand(18, 26);
  const points = [];
  const count = Math.floor(rand(8, 14));

  for (let i = 0; i < count; i++) {
    points.push(rand(0.6, 1.2));
  }

  const angle = rand(0, Math.PI * 2);
  const speed = rand(1, 2.5) + difficulty * 0.2;

  asteroids.push({
    x, y,
    vx: Math.cos(angle) * speed,
    vy: Math.sin(angle) * speed,
    r: radius,
    shape: points,
    size
  });
}

function spawnAsteroid() {
  const edge = Math.floor(Math.random() * 4);
  let x, y;

  if (edge === 0) { x = rand(0, canvas.width); y = -60; }
  if (edge === 1) { x = canvas.width + 60; y = rand(0, canvas.height); }
  if (edge === 2) { x = rand(0, canvas.width); y = canvas.height + 60; }
  if (edge === 3) { x = -60; y = rand(0, canvas.height); }

  createAsteroid(x, y, Math.random() < 0.6 ? 3 : 2);
}

/* ---------- EFFECTS ---------- */
function explode(x, y, color, count = 25) {
  for (let i = 0; i < count; i++) {
    particles.push({
      x, y,
      vx: rand(-4, 4),
      vy: rand(-4, 4),
      life: rand(20, 40),
      color
    });
  }
}

/* ---------- SHOOT ---------- */
function shoot() {
  if (player.shootCooldown > 0) return;
  player.shootCooldown = 8;

  bullets.push({
    x: player.x,
    y: player.y,
    vx: Math.cos(player.angle) * 12,
    vy: Math.sin(player.angle) * 12,
    life: 60
  });
}

/* ---------- MAIN LOOP ---------- */
function update() {
  requestAnimationFrame(update);
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  difficulty += 0.0005;

  /* --- Player Movement --- */
  if (keys["w"] || keys["arrowup"]) player.vy -= 0.4;
  if (keys["s"] || keys["arrowdown"]) player.vy += 0.4;
  if (keys["a"] || keys["arrowleft"]) player.vx -= 0.4;
  if (keys["d"] || keys["arrowright"]) player.vx += 0.4;

  player.vx *= 0.97;
  player.vy *= 0.97;
  player.x += player.vx;
  player.y += player.vy;

  player.x = (player.x + canvas.width) % canvas.width;
  player.y = (player.y + canvas.height) % canvas.height;

  player.angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);

  if ((mouse.down || keys[" "])) shoot();
  if (player.shootCooldown > 0) player.shootCooldown--;

  /* --- Bullets --- */
  bullets = bullets.filter(b => b.life-- > 0);
  bullets.forEach(b => {
    b.x += b.vx;
    b.y += b.vy;
    ctx.fillStyle = "#0ff";
    ctx.fillRect(b.x - 2, b.y - 2, 4, 4);
  });

  /* --- Asteroid Spawning --- */
  spawnTimer--;
  if (spawnTimer <= 0) {
    spawnAsteroid();
    spawnAsteroid(); // double spawn = chaos
    spawnTimer = Math.max(10, 60 - difficulty * 5);
  }

  /* --- Asteroids --- */
  asteroids = asteroids.filter(a => {
    a.x += a.vx;
    a.y += a.vy;

    ctx.strokeStyle = "#f0f";
    ctx.beginPath();
    a.shape.forEach((p, i) => {
      const ang = (i / a.shape.length) * Math.PI * 2;
      const r = a.r * p;
      const px = a.x + Math.cos(ang) * r;
      const py = a.y + Math.sin(ang) * r;
      i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
    });
    ctx.closePath();
    ctx.stroke();

    /* Bullet collision */
    for (let b of bullets) {
      if (Math.hypot(a.x - b.x, a.y - b.y) < a.r) {
        explode(a.x, a.y, "#f0f");
        score += 10 * a.size;

        if (a.size > 1) {
          createAsteroid(a.x, a.y, a.size - 1);
          createAsteroid(a.x, a.y, a.size - 1);
        }
        return false;
      }
    }

    /* Player collision */
    if (Math.hypot(a.x - player.x, a.y - player.y) < a.r + 12) {
      explode(player.x, player.y, "#f00", 40);
      player.lives--;
      if (player.lives <= 0) {
        alert("GAME OVER\nScore: " + score);
        location.reload();
      }
      return false;
    }

    return true;
  });

  /* --- Player Render --- */
  ctx.save();
  ctx.translate(player.x, player.y);
  ctx.rotate(player.angle);
  ctx.strokeStyle = "#0ff";
  ctx.beginPath();
  ctx.moveTo(16, 0);
  ctx.lineTo(-10, 8);
  ctx.lineTo(-10, -8);
  ctx.closePath();
  ctx.stroke();
  ctx.restore();

  /* --- Particles --- */
  particles = particles.filter(p => p.life-- > 0);
  particles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x, p.y, 2, 2);
  });

  ui.innerHTML = `Score: ${score}<br>Lives: ${player.lives}<br>Difficulty: ${difficulty.toFixed(1)}`;
}

update();
</script>
</body>
</html>
