<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Paradox Prism: Final Edition</title>
    <style>
        body { margin: 0; background: #000; color: #0ff; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        #container { position: relative; border: 4px solid #333; box-shadow: 0 0 20px #0ff; }
        #ui { position: absolute; top: 15px; left: 15px; pointer-events: none; font-size: 18px; }
        canvas { display: block; background: #050505; }
        .controls { position: absolute; bottom: 15px; width: 100%; text-align: center; color: #444; font-size: 12px; }
    </style>
</head>
<body>
    <div id="container">
        <div id="ui">LEVEL: <span id="lvl">1</span> | PHASE: <span id="phase">BLUE</span></div>
        <canvas id="game"></canvas>
        <div class="controls">WASD / ARROWS to Move | SPACE to Shift Reality</div>
    </div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 600;

let levelIdx = 0;
let phase = 'BLUE';
const keys = {};

// Tile size
const TILE_SIZE = 40;

// Camera
const camera = { x: 0, y: 0, w: canvas.width, h: canvas.height };

// Player
const player = { x: 0, y: 0, w: 30, h: 30, vx: 0, vy: 0, speed: 5, jump: -12, grounded: false };
// 1=Wall, 2=Blue, 3=Red, 4=Goal, 5=Spike, P=Player
// Levels
const levels = [
    [
        "11111111111111111111",
        "1P020000000000000001",
        "11100000000000000001",
        "10000033330000000001",
        "10000000000003330001",
        "10003300000003400001",
        "11111111111111111111"
    ],
    [
        "11111111111111111111",
        "10000000000000000001",
        "13111111111111111101",
        "10140000000000000121",
        "12111111111111110101",
        "10111111111111113131",
        "13111111111111110101",
        "10111111111111112121",
        "12111111111111110101",
        "10111111111111113131",
        "13000000000000000101",
        "11111111111111111121",
        "1P000000000000000001",
        "11111111111111111111"
    ],
    [
    "11111111111111111111",
    "10000000000000000041",
    "10000000000000000001",
    "10000000000000000201",
    "10000000000000000001",
    "10000000000000000031",
    "10000000000000002001",
    "10000000000003000001",
    "10000000002000000001",
    "10000003000000000001",
    "10002000000000000001",
    "1P010000000000000001",
    "10010000000000000001",
    "10315555555555555551",
    "11111111111111111111",
    ],
    [
    "00000000000000000000",
    "00000000000000000000",
    "00000000000000000000",
    "00000000000000000000",
    "00000000000000000000",
    "00000000000000000000",
    "00000000000000000000",
    "00000000000000000000",
    "11111111111111111111",
    "10000000000000000001",
    "1P000000000000000001",
    "10000000000000000001",
    "10000000000000000041",
    "11535553535553553511",
    "11111111111111111111"
    ],
    [
    "11111111111111111111",
    "1P011111111111111111",
    "10011111111111111111",
    "12211111111111111111",
    "10000000000001111111",
    "12212111211121111111",
    "10010111011101111111",
    "15510111011100411111",
    "11110111000121000011",
    "11110001210151220011",
    "11112101510111000311",
    "11115101110000000011",
    "11111101111110020011",
    "11111151111111000011",
    "11111111111111111111"
    ]
];

// Initialize level
function initLevel() {
    const map = levels[levelIdx % levels.length];
    for(let r=0; r<map.length; r++) {
        for(let c=0; c<map[r].length; c++) {
            if(map[r][c] === 'P') {
                player.x = c * TILE_SIZE;
                player.y = r * TILE_SIZE;
                player.vx = 0;
                player.vy = 0;
            }
        }
    }
    document.getElementById('lvl').innerText = levelIdx + 1;
}

// Input
window.onkeydown = e => {
    keys[e.code] = true;
    if(e.code === 'Space') {
        phase = phase === 'BLUE' ? 'RED' : 'BLUE';
        document.getElementById('phase').innerText = phase;
        document.getElementById('phase').style.color = phase === 'BLUE' ? '#0af' : '#f05';
    }
};
window.onkeyup = e => keys[e.code] = false;

// Update camera to follow player
function updateCamera() {
    camera.x = player.x + player.w/2 - camera.w/2;
    camera.y = player.y + player.h/2 - camera.h/2;

    // Clamp camera to level bounds
    const map = levels[levelIdx % levels.length];
    const levelWidth = map[0].length * TILE_SIZE;
    const levelHeight = map.length * TILE_SIZE;
    if(camera.x < 0) camera.x = 0;
    if(camera.y < 0) camera.y = 0;
    if(camera.x + camera.w > levelWidth) camera.x = levelWidth - camera.w;
    if(camera.y + camera.h > levelHeight) camera.y = levelHeight - camera.h;
}

// Update loop
function update() {
    const map = levels[levelIdx % levels.length];

    // Input
    if(keys['ArrowLeft'] || keys['KeyA']) player.vx = -player.speed;
    else if(keys['ArrowRight'] || keys['KeyD']) player.vx = player.speed;
    else player.vx *= 0.8;

    player.vy += 0.6; // gravity

    // Move X
    player.x += player.vx;
    collide(map, true);

    // Move Y
    player.y += player.vy;
    player.grounded = false;
    collide(map, false);

    if((keys['ArrowUp'] || keys['KeyW']) && player.grounded) {
        player.vy = player.jump;
        player.grounded = false;
    }

    updateCamera();

    // Draw
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for(let r=0; r<map.length; r++) {
        for(let c=0; c<map[r].length; c++) {
            const char = map[r][c];
            if(char === '0' || char === 'P') continue;

            const x = c * TILE_SIZE - camera.x;
            const y = r * TILE_SIZE - camera.y;

            if(char === '1') ctx.fillStyle = '#333';
            else if(char === '2') { ctx.fillStyle = '#0af'; ctx.globalAlpha = (phase === 'BLUE' ? 1 : 0.2); }
            else if(char === '3') { ctx.fillStyle = '#f05'; ctx.globalAlpha = (phase === 'RED' ? 1 : 0.2); }
            else if(char === '4') ctx.fillStyle = '#0f0';
            else if(char === '5') ctx.fillStyle = '#f00';

            ctx.fillRect(x, y, TILE_SIZE, TILE_SIZE);
            ctx.globalAlpha = 1;
        }
    }

    // Draw player
    ctx.fillStyle = (phase === 'BLUE' ? '#0af' : '#f05');
    ctx.fillRect(player.x - camera.x, player.y - camera.y, player.w, player.h);
    ctx.strokeStyle = '#fff';
    ctx.strokeRect(player.x - camera.x, player.y - camera.y, player.w, player.h);

    requestAnimationFrame(update);
}

// Collision
function collide(map, isX) {
    const rows = map.length;
    const cols = map[0].length;

    for(let r=0; r<rows; r++) {
        for(let c=0; c<cols; c++) {
            const char = map[r][c];
            if(char === '0' || char === 'P') continue;
            if(char === '2' && phase === 'RED') continue;
            if(char === '3' && phase === 'BLUE') continue;

            const tx = c * TILE_SIZE;
            const ty = r * TILE_SIZE;

            if(player.x < tx + TILE_SIZE && player.x + player.w > tx &&
               player.y < ty + TILE_SIZE && player.y + player.h > ty) {
                
                if(char === '4') { levelIdx++; initLevel(); return; }
                if(char === '5') { initLevel(); return; }

                if(isX) {
                    if(player.vx > 0) player.x = tx - player.w;
                    if(player.vx < 0) player.x = tx + TILE_SIZE;
                    player.vx = 0;
                } else {
                    if(player.vy > 0) { player.y = ty - player.h; player.grounded = true; }
                    if(player.vy < 0) player.y = ty + TILE_SIZE;
                    player.vy = 0;
                }
            }
        }
    }
}

initLevel();
update();
</script>
</body>
</html>