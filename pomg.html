<!DOCTYPE html>
<html>
<head>
  <title>Basic Snake HTML Game</title>
  <meta charset="UTF-8">
  <style>
  html, body {
    height: 100%;
    margin: 0;
  }

  body {
    background: black;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  canvas {
    border: 1px solid white;
  }
  </style>
</head>
<body>
<canvas width="600" height="400" id="game"></canvas>
<script>
var canvas = document.getElementById('game');
var context = canvas.getContext('2d');


var count = 0;
var distance_to_cpu = 0;
var ball_speed = 5;

var paddle_speed = 5;
var cpu_speed = 4;

let rightPressed = false;
let leftPressed = false;

const REACTION_CHANCE = 0.98;   // higher = smarter CPU
const PANIC_DISTANCE = 200;
const PANIC_SPEED = 6;

var ball = {
  x: 280,
  y: 180,
  dx: -1,
  dy: -1,
}

var paddle = {
    y: 200,
    x: 10,

    
}

var cpu = {
    y: 200,
    x: 590,
    dir: 1,

    
}

let dir = 0;

let score = 0;
let cpu_score = 0;



// get random whole numbers in a specific range
// @see https://stackoverflow.com/a/1527820/2124254

// game loop
function loop() {
    requestAnimationFrame(loop);


    count = 0;
    context.clearRect(0,0,canvas.width,canvas.height);




    context.fillStyle = "white";
    context.fillRect(ball.x, ball.y, 10, 10);
    context.fillRect(cpu.x, cpu.y, 5, 60);
    context.fillRect(paddle.x, paddle.y, 5, 60);




    ball.x += ball.dx * ball_speed;
    ball.y += ball.dy * ball_speed;

    distance_to_cpu = ball.x - paddle.x;

    if (leftPressed && paddle.y < canvas.height - 60) {
      paddle.y += paddle_speed;
    }
    else if (rightPressed && paddle.y > 0) {
      paddle.y -= paddle_speed;
    }

    context.font = '30px sans-serif';
    context.fillStyle = 'white';

    context.fillText(score + ' - ' + cpu_score, canvas.width/2 - 50, 30);

   





    if (ball.y < 1) {
        ball.dy = 1;
    }
    if (ball.y > canvas.height - 11) {
        ball.dy = -1;
    }

    if (ball.x < 15 && ball.y > paddle.y && ball.y < paddle.y + 60) {
        ball.dx = 1;
    }

    if (ball.x > 575 && ball.y > cpu.y && ball.y < cpu.y + 60) {
        ball.dx = -1;
    }

    if (ball.x > canvas.width - 11) {
        score += 1;
        ball.x = canvas.width/2;
        ball.y = canvas.height/2;
    }

    if (ball.x < 0) {
        cpu_score += 1;
        ball.x = canvas.width/2;
        ball.y = canvas.height/2;
    }

if (Math.random() > REACTION_CHANCE) {
  // do nothing this frame
} else {

  // Aim error scales with ball speed
  let error = ball_speed * 0.5;
  let targetY = ball.y + 5 + error * (Math.random() - 0.5);

  if (distance_to_cpu > PANIC_DISTANCE) {
    // Smart tracking mode
    if (cpu.y + 30 < targetY) {
      cpu.y += cpu_speed;
    } 
    else if (cpu.y + 30 > targetY) {
      cpu.y -= cpu_speed;
    }
  } 
  else if (distance_to_cpu < PANIC_DISTANCE && ball.speed > PANIC_SPEED) {
    // Panic mode only if ball is fast
    cpu.y += cpu_speed * dir;
  }
}

// Wall collision & direction flip
if (cpu.y < 0) {
  cpu.y = 0;
  dir = 1;
}
if (cpu.y > canvas.height - 60) {
  cpu.y = canvas.height - 60;
  dir = -1;
}



}

// listen to keyboard events to move the snake
function keyDownHandler(e) {
  if (e.key === "Up" || e.key === "ArrowUp") {
    rightPressed = true;
  } else if (e.key === "Down" || e.key === "ArrowDown") {
    leftPressed = true;
  }
}

function keyUpHandler(e) {
  if (e.key === "Up" || e.key === "ArrowUp") {
    rightPressed = false;
  } else if (e.key === "Down" || e.key === "ArrowDown") {
    leftPressed = false;
  }
}

document.addEventListener("keydown", keyDownHandler);
document.addEventListener("keyup", keyUpHandler);
// start the game
requestAnimationFrame(loop);
</script>
</body>
</html>